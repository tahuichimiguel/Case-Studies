---
title: "Fatal Police Shootings"
author: "Mikhail Lara"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Data Structure & Summary
```{r cars}
#options(warn=-1)
library(ggplot2)
library(gridExtra)
library(maps)
library(data.table)
library(lubridate)
library(RColorBrewer)

path='/Users/Mikey/Documents/ML-Case-Studies/US Police Shooting Fatalities'
setwd(path)

filenames<-c('Guardian_2015.csv','Guardian_2016.csv','WP_database.csv')
guard2015.dt<-fread(filenames[1],sep=',')
guard2016.dt<-fread(filenames[2],sep=',')
wp.dt<-fread(filenames[3],sep=',')

##Data Structure & Summary
summary(guard2015.dt)
summary(guard2016.dt)
summary(wp.dt)

```

##Data Cleaning
```{r}
#Data Cleaning

clean.Guard2015 <-function(datafile){
    datafile[,age:=ifelse(age=='Unknown',-1,age)] #-1: Unknown
    
    datafile[,uid:=as.numeric(uid)]
    datafile[,age:=as.numeric(age)]
    datafile[,gender:=as.factor(gender)]
    
    datafile[,race:=as.factor(raceethnicity)]
    datafile[,raceethnicity:=NULL]
    
    datafile[,armed:=as.factor(armed)]
    datafile[,day:=as.factor(day)]
    datafile[,state:=as.factor(state)]
    datafile[,classification:=as.factor(classification)]
    
    datafile
}

clean.Guard2016<-function(datafile){
    datafile[,age:=ifelse(age=='Unknown',-1,age)] #-1: Unknown
    datafile[,age:=ifelse(age=='40s',-2,age)] #-1: 'Unknown'40s'

    datafile[,uid:=as.numeric(uid)]
    datafile[,age:=as.numeric(age)]
    datafile[,gender:=as.factor(gender)]

    datafile[,race:=as.factor(raceethnicity)]
    datafile[,raceethnicity:=NULL]
    
    datafile[,armed:=as.factor(armed)]
    datafile[,day:=as.factor(day)]
    datafile[,state:=as.factor(state)]
    datafile[,classification:=as.factor(classification)]
    
    datafile
}

clean.wp<-function(datafile){
    datafile[,date:=ymd(date)]
    datafile[,manner_of_death:=as.factor(manner_of_death)]
    datafile[,armed:=as.factor(armed)]
    datafile[,gender:=as.factor(gender)]
    datafile[,race:=as.factor(race)]
    datafile[,signs_of_mental_illness:=as.factor(signs_of_mental_illness)]
    datafile[,threat_level:=as.factor(threat_level)]
    datafile[,flee:=as.factor(flee)]
    datafile[,body_camera:=as.factor(body_camera)]
    datafile[,state:=as.factor(state)]
   
    datafile[,age:=ifelse(is.na(age),-3,age)]
    
    datafile[,year:=day(date)] 
    datafile[,month:=month(date,label=TRUE,abbr=FALSE)]
    datafile[,year:=year(date)]
    
    datafile
}
```

```{r}
#Create Single data table for each source
clean.guard.dt<-rbindlist(
                    list(
                        clean.Guard2015(guard2015.dt),
                        clean.Guard2016(guard2016.dt)
                        ),
                    use.names=TRUE
                    )

clean.wp.dt<-clean.wp(wp.dt)

```

#Exploratory Data Analysis

Victim Descriptors      | Officer Descriptors   | Situation Descriptors
    ------------        | -------------         |   ------------- 
    Name(G & WP)        |  Body Camera          |   Date(G & WP)
    Age(G & WP)         |  -------------        |   Location (G & WP)
    Race(G & WP)        |  -------------        |   Signs of Mental Illness
    Gender(G & WP)      |  -------------        |   Armed(G & WP)
    Signs of Mental Illness (WP)    |  -------------        |   Classification/Manner of Death (G & WP)
    -------------       |  -------------        |   Threat Level (WP)
    -------------       |  -------------        |   Flee (WP)
    -------------     |  -------------          |   Law Enforcement Agency
##Guardian Data

```{r}
##Victim

    #Age Distribution
    g.guard.age<-ggplot(data = clean.guard.dt,aes(x=age))+
        geom_histogram(data=subset(clean.guard.dt[age>=0,],year == '2015'),
                       fill = "red", alpha = 0.5,bins=35) +
        geom_histogram(data=subset(clean.guard.dt[age>=0,],year == '2016'),
                       fill = "blue", alpha = 0.5,bins=35) +
        scale_fill_discrete(guide=FALSE)+
        ggtitle("The Guardian: Victim Information") + 
        xlab('Victim Age')+ylab('Fatalities')+theme(text = element_text(size = 12))+
        annotate("text", x = 70, y = 100, 
                 label = paste('Median Age = ',median(clean.guard.dt$age)))

    
    #Race Distribution
    g.guard.race<-ggplot(data=clean.guard.dt, aes(x=reorder(race, table(race)[race]))) + 
        geom_bar(fill='red')+
        xlab('Race')+ylab('Total Fatalities 2015-2016')+
        theme(text = element_text(size = 12))+
        coord_flip()
        
    grid.arrange(g.guard.age,g.guard.race,ncol=1)

##Situation
    
    #Location (States)
    g.guard.state<-ggplot(data=clean.guard.dt, 
                          aes(x=reorder(state, table(state)[state]))) + 
        geom_bar(fill='red')+coord_flip()+
        xlab('State')+ylab('Fatalities')+
        theme(text = element_text(size = 10))
    
    #Armed
    g.guard.armed<-ggplot(data=clean.guard.dt, 
                          aes(x=reorder(armed, table(armed)[armed]))) + 
        geom_bar(fill='red')+coord_flip()+
        xlab('Armed')+ylab('Fatalities')+
        theme(text = element_text(size = 10))
    
    #Cause of Death
    g.guard.class<-ggplot(data=clean.guard.dt, 
                          aes(x=reorder(classification, 
                                        table(classification)[classification]))) + 
        geom_bar(fill='red')+coord_flip()+
        xlab('Cause of Death')+ylab('Fatalities')+
        theme(text = element_text(size = 10))
    
    g.guard.state
    grid.arrange(g.guard.class,g.guard.armed,ncol=2)


```


#Washington Post Data
```{r}
##Victim

    #Victim Age Distribution each Year
    g.wp.age<-ggplot(data = clean.wp.dt,aes(x=age))+
        geom_histogram(data=subset(clean.wp.dt[age>=0,],year==2015),
                       fill='red',bins=35,alpha=0.5)+
        geom_histogram(data=subset(clean.wp.dt[age>=0,],year==2016),
                       fill='blue',bins=35,alpha=0.5)+
        ggtitle("Washington Post: Victim Information") + 
        xlab('Age')+ylab('Fatalities')+
        scale_fill_discrete(guide=FALSE)+theme(text = element_text(size = 15))+
        annotate("text", x = 70, y = 75, 
                 label = paste('Median Age = ',median(clean.wp.dt$age)))
    
    #Police Killings by Race
    g.wp.race<- ggplot(data=clean.wp.dt, aes(x=reorder(race,table(race)[race])))+
        geom_bar(fill='red')+ 
        xlab('Race')+ylab('Fatalities 2015-2016')+
        theme(text = element_text(size = 15))+
        coord_flip()

    grid.arrange(g.wp.age,g.wp.race,ncol=1)

    dt[!is.na(age),.(median=as.double(median(age)),SD=sd(age)),by="YEAR"]
    
##Situation

    #Location (States)
    g.wp.state<-ggplot(data=clean.wp.dt, aes(x=reorder(state, table(state)[state]))) + 
        geom_bar(fill='red')+coord_flip()+
        xlab('State')+ylab('Fatalities')+
        theme(text = element_text(size = 10))
    
    #Armed
    g.wp.armed<-ggplot(data=clean.wp.dt, aes(x=reorder(armed, table(armed)[armed]))) + 
        geom_bar(fill='red')+coord_flip()+
        xlab('Armed')+ylab('Fatalities')+
        theme(text = element_text(size = 10))
```




```{r}    
#Previous WP 'TOP' Analysis

#Top 10 Weapons in Possession of Killed Citizen
tbl_armed<- table(dt$armed)
  tbl_armed<-tbl_armed[order(tbl_armed)]

  top10_armed<-tail(tbl_armed,n=10)
  top10_armed.df<-data.frame(top10_armed)
  print(
      paste(
              'Top 10 Armed Statuses Account for' ,
                    as.character(sum(top10_armed)/sum(tbl_armed)*100) ,
                    '% of National Occurrences'
            ),sep = ''
      )

gTopArmed<-ggplot(data = top10_armed.df, aes(x=Var1,y=Freq))+geom_bar(stat='identity')+
    geom_bar(stat='identity',fill='red')+
    xlab('Armed')+ylab('Associated Deaths 2015-2016')  +coord_flip()

#State Distribution of Police Shootings
tbl_state<-table(dt$state)
  tbl_state<-tbl_state[order(tbl_state)]
  tbl_state.df<-data.frame(tbl_state)

  top_states<-tail(tbl_state,n=40)
  top_states.df<-data.frame(top_states)

  print(paste('Median 2015-2016 State Deaths by Police Shootings is ',
              median(tbl_state) ))

  print(
   paste(
          'Top 40 States Account for' ,
                as.character(sum(top_states)/sum(tbl_state)*100) ,
                '% of National Occurrences'
        ),sep = ''
  )

ggplot(data = data.frame(tbl_state),aes(x=Var1,y=Freq))+
    geom_bar(stat='identity',fill='red')+coord_flip()+
    xlab('State')+ylab('Associated Deaths 2015-2016')

```

# Map of USA
```{r}
states <- map_data("state")
 arrests <- USArrests
 names(arrests) <- tolower(names(arrests))
 arrests$region <- tolower(rownames(USArrests))

choro <- merge(states, arrests, sort = FALSE, by = "region")
choro <- choro[order(choro$order), ]

ggplot(choro, aes(long, lat)) +
geom_polygon(aes(group = group, fill = assault/murder)) +
    coord_map("albers",  at0 = 45.5, lat1 = 29.5)
```




