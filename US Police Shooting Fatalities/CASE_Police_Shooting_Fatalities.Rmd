---
title: "Fatal Police Shootings"
author: "Mikhail Lara"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Data Structure & Summary
```{r cars}
library(ggplot2)
library(maps)
library(data.table)
library(lubridate)

setwd('/Users/Mikey/Documents/ML-Case-Studies/US Police Shooting Fatalities')
dt <- fread('database.csv',sep = ',')

##Data Structure & Summary
summary(dt)
head(dt)
```

##Data Cleaning
```{r}
dt[,date:=ymd(date)]
dt[,manner_of_death:=as.factor(manner_of_death)]
dt[,armed:=as.factor(armed)]
dt[,gender:=as.factor(gender)]
dt[,race:=as.factor(race)]
dt[,signs_of_mental_illness:=as.factor(signs_of_mental_illness)]
dt[,threat_level:=as.factor(threat_level)]
dt[,flee:=as.factor(flee)]
dt[,body_camera:=as.factor(body_camera)]
dt[,state:=as.factor(state)]
dt[,YEAR:=year(date)]

summary(dt)
dt[,.N,by = year(date)]
```

#EDA

###Victim Descriptors
    + Name
    + Age
    + Race
    + Gender
    
###Officer Descriptors
    + Body Camera
    
```{r}
#Victim Age Distribution each Year
gAge<-ggplot(data = dt, aes(age,fill=as.factor(YEAR)))+
  geom_histogram(bins=35)+ facet_grid(.~YEAR) +
  scale_fill_discrete(guide=FALSE)+theme(text = element_text(size = 15))

  dt[!is.na(age),.(median=as.double(median(age)),SD=sd(age)),by="YEAR"]

#Police Killings by Race
tbl_race<-table(dt$race)
  tbl_race<-tbl_race[order(tbl_race)]
  tbl_race.df<-data.frame(tbl_race)
  
gRace<- ggplot(data=tbl_race.df, aes(x=Var1,y=Freq))+
    geom_bar(stat='identity',fill='red')+
    xlab('Race')+ylab('Total Killings 2015-2016')+
    theme(text = element_text(size = 15))+
    coord_flip()  
```


###Situation Descriptors
    + Date
    + Location (State , City)
    + Signs of Mental Illness
    + Armed
    + Manner of Death
    + Threat Level
    + Flee
    
```{r}
#Top 10 Weapons in Possession of Killed Citizen 
tbl_armed<- table(dt$armed)
  tbl_armed<-tbl_armed[order(tbl_armed)]
  
  top10_armed<-tail(tbl_armed,n=10)
  top10_armed.df<-data.frame(top10_armed)
  print(
      paste(
              'Top 10 Armed Statuses Account for' , 
                    as.character(sum(top10_armed)/sum(tbl_armed)*100) , 
                    '% of National Occurrences'
            ),sep = ''
      )
  
gTopArmed<-ggplot(data = top10_armed.df, aes(x=Var1,y=Freq))+geom_bar(stat='identity')+
    geom_bar(stat='identity',fill='red')+
    xlab('Armed')+ylab('Associated Deaths 2015-2016')  +coord_flip()

#State Distribution of Police Shootings
tbl_state<-table(dt$state)
  tbl_state<-tbl_state[order(tbl_state)]
  tbl_state.df<-data.frame(tbl_state)
  
  top_states<-tail(tbl_state,n=40)
  top_states.df<-data.frame(top_states)
  
  print(paste('Median 2015-2016 State Deaths by Police Shootings is ', median(tbl_state) ))
  
  print(
   paste(
          'Top 40 States Account for' , 
                as.character(sum(top_states)/sum(tbl_state)*100) , 
                '% of National Occurrences'
        ),sep = ''
  )
  
ggplot(data = data.frame(tbl_state),aes(x=Var1,y=Freq))+
    geom_bar(stat='identity',fill='red')+coord_flip()+
    xlab('State')+ylab('Associated Deaths 2015-2016')

```

Map of USA
```{r}
states <- map_data("state")
 arrests <- USArrests
 names(arrests) <- tolower(names(arrests))
 arrests$region <- tolower(rownames(USArrests))

choro <- merge(states, arrests, sort = FALSE, by = "region")
choro <- choro[order(choro$order), ]

ggplot(choro, aes(long, lat)) +
geom_polygon(aes(group = group, fill = assault/murder)) +
    coord_map("albers",  at0 = 45.5, lat1 = 29.5)
```




